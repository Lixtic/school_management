{% load humanize %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt #{{ payment.reference }}</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { 
            background: #f3f4f6; 
            font-family: 'Inter', sans-serif;
            color: #1f2937;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            font-size: 0.9rem;
        }
        
        .receipt-card {
            max-width: 550px; /* Compact width */
            margin: 30px auto;
            background: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .receipt-header {
            background: #fff;
            padding: 25px 30px 15px; /* Compact padding */
            border-bottom: 2px solid #f3f4f6;
        }

        .school-logo {
            width: 60px; height: 60px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .school-name {
            font-weight: 700;
            font-size: 1.25rem;
            color: #111827;
            margin-bottom: 2px;
            text-transform: uppercase;
        }

        .school-info {
            font-size: 0.8rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .receipt-body {
            padding: 25px 30px; /* Compact padding */
        }

        .receipt-title {
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.7rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 2px;
        }
        
        .receipt-value {
            font-size: 1rem;
            font-weight: 600;
            color: #111827;
        }

        .amount-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }

        .amount-total {
            font-size: 1.5rem;
            font-weight: 800;
            color: #059669; /* Green-600 */
            line-height: 1.2;
        }

        .amount-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 2px;
        }

        .table-clean th {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #6b7280;
            font-weight: 600;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
        }
        
        .table-clean td {
            padding: 10px 0;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            font-size: 0.9rem;
        }

        .receipt-footer {
            background: #f9fafb;
            padding: 15px 30px;
            font-size: 0.7rem;
            color: #9ca3af;
            text-align: center;
            border-top: 1px solid #e5e7eb;
        }

        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 5rem;
            font-weight: 800;
            color: rgba(0,0,0,0.03);
            pointer-events: none;
            letter-spacing: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            border: 1px solid #059669;
            color: #059669;
        }

        @media print {
            body { background: white; margin: 0; }
            .receipt-card { 
                box-shadow: none; 
                margin: 0 auto; 
                border: 1px solid #eee;
                max-width: 100%; 
                width: 148mm; /* A5 width approx */
            }
            .no-print { display: none !important; }
            .receipt-footer { position: relative; bottom: auto; }
        }
    </style>
</head>
<body>

    <div class="d-flex justify-content-center my-4 no-print gap-3">
        <button onclick="window.print()" class="btn btn-dark px-4 shadow-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">
                <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"/>
                <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
            </svg>
            Print Receipt
        </button>
        <button onclick="window.close()" class="btn btn-outline-secondary px-4">Close</button>
    </div>

    <div class="receipt-card">
        <div class="watermark">PAID</div>

        <!-- Header -->
        <div class="receipt-header text-center">
            
            {% if school_info.logo %}
                <img src="{{ school_info.logo.url }}" alt="Logo" class="school-logo">
            {% endif %}
            
            <div class="school-name">{{ school_info.name|default:"School Management System" }}</div>
            <div class="school-info">
                {{ school_info.address }}<br>
                {{ school_info.phone }} | {{ school_info.email }}
            </div>
        </div>

        <!-- Body -->
        <div class="receipt-body">
            <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-3">
                <div>
                    <div class="receipt-title">Payment Receipt</div>
                    <div class="fs-5 fw-bold">#{{ payment.reference }}</div>
                </div>
                <div class="text-end">
                    <div class="receipt-title">Date</div>
                    <div class="receipt-value">{{ payment.date|date:"F d, Y" }}</div>
                </div>
            </div>

            <div class="row align-items-center mb-3">
                <div class="col-8 pe-0">
                    <div class="mb-2">
                        <div class="receipt-title">Received From</div>
                        <div class="receipt-value fs-6">{{ payment.student_fee.student.user.get_full_name }}</div>
                        <div class="text-muted small">
                            {{ payment.student_fee.student.current_class }} ({{ payment.student_fee.student.admission_number }})
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="amount-box">
                        <div class="amount-label">Paid</div>
                        <div class="amount-total">₵{{ payment.amount|floatformat:2|intcomma }}</div>
                    </div>
                </div>
            </div>

            <!-- Transaction Details Table -->
            <table class="table table-clean w-100 mb-3">
                <thead>
                    <tr>
                        <th style="width: 40%">Fee Details</th>
                        <th class="text-end">Total</th>
                        <th class="text-end">Bal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="fw-bold text-dark">{{ payment.student_fee.fee_structure.head.name }}</div>
                            <div class="text-muted small" style="font-size: 0.75rem;">
                                {{ payment.student_fee.fee_structure.get_term_display }}
                            </div>
                        </td>
                        <td class="text-end">₵{{ payment.student_fee.amount_payable|floatformat:2|intcomma }}</td>
                        <td class="text-end fw-bold text-danger">₵{{ payment.student_fee.balance|floatformat:2|intcomma }}</td>
                    </tr>
                </tbody>
            </table>

            <div class="text-muted small fst-italic mt-2">
                 Paid via {{ payment.method }}{% if payment.reference %} (Ref: {{ payment.reference }}){% endif %}
            </div>

            {% if payment.remarks %}
            <div class="alert alert-light border p-2 mt-2 mb-0 small">
                <strong>Note:</strong> {{ payment.remarks }}
            </div>
            {% endif %}
        </div>

        <!-- Footer -->
        <div class="receipt-footer">
            <p class="mb-1">Thank you for your payment!</p>
            <p class="mb-0">Generated on {% now "F d, Y H:i" %}</p>
        </div>
    </div>

</body>
</html>
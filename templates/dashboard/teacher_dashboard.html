{% extends 'base.html' %}

{% block content %}
<div class="d-flex align-items-center mb-4">
    <div>
        <div class="badge-soft mb-2">Teacher</div>
        <h2 class="page-title mb-1">Welcome back, {{ user.get_full_name }}!</h2>
        <p class="text-muted mb-0">Manage your classes, attendance, and grades.</p>
    </div>
</div>

{% if not teacher_has_classes %}
<div class="alert alert-warning d-flex align-items-center gap-2 mb-4" role="alert">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <div>
        You are not assigned to any classes for the current academic year. Attendance and grade entry will stay locked until an admin assigns you.
    </div>
</div>
{% endif %}

<!-- Upcoming Duty Alert -->
{% if next_duty %}
<div class="alert alert-info border-0 shadow-sm mb-4">
    <div class="d-flex align-items-center">
        <div class="flex-shrink-0">
            <div class="display-6 text-info"><i class="bi bi-calendar-check"></i></div>
        </div>
        <div class="flex-grow-1 ms-3">
            <h5 class="alert-heading fw-bold mb-1">Upcoming Duty Assignment</h5>
            <p class="mb-0">
                You are assigned as <strong>{{ next_duty.role }}</strong> for the week of 
                <strong>{{ next_duty.week.start_date|date:"M d" }} - {{ next_duty.week.end_date|date:"M d, Y" }}</strong>.
            </p>
        </div>
        <div class="flex-shrink-0 ms-3">
            <a href="{% url 'teachers:duty_roster_pdf' %}" class="btn btn-sm btn-light text-info fw-bold">View Roster</a>
        </div>
    </div>
</div>
{% endif %}

<!-- School Notices -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0 fw-bold text-primary"><i class="bi bi-megaphone"></i> School Notices</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% for notice in notices %}
                    <div class="list-group-item d-flex gap-3 py-3 border-bottom">
                        <div class="flex-shrink-0">
                            <span class="badge bg-primary rounded-circle p-2"><i class="bi bi-info-lg"></i></span>
                        </div>
                        <div class="d-flex gap-2 w-100 justify-content-between">
                            <div>
                                <h6 class="mb-1 fw-bold">{{ notice.title }}</h6>
                                <p class="mb-0 text-muted small">{{ notice.content }}</p>
                            </div>
                            <small class="text-muted text-nowrap">{{ notice.created_at|date:"M d" }}</small>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-muted fst-italic py-2">No active announcements.</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-4">
        <div class="card h-100" style="background: var(--gradient-strong); color: #fff;">
            <div class="card-body text-center">
                <i class="bi bi-pencil-square" style="font-size: 2.6rem;"></i>
                <h5 class="mt-3">Enter Grades</h5>
                <p class="text-white-50 mb-3">Capture classwork and exam scores quickly.</p>
                <a href="{% url 'teachers:enter_grades' %}" class="btn btn-light btn-sm rounded-pill">Go to Grades</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="bi bi-book" style="font-size: 2.6rem; color: var(--secondary-color);"></i>
                <h5 class="mt-3">My Classes</h5>
                <p class="text-muted mb-3">View your assigned classes and subjects.</p>
                <a href="{% url 'teachers:my_classes' %}" class="btn btn-outline-primary btn-sm">View Classes</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="bi bi-calendar-check" style="font-size: 2.6rem; color: #2ec4b6;"></i>
                <h5 class="mt-3">Attendance</h5>
                <p class="text-muted mb-3">Mark or review recent attendance.</p>
                <a href="{% url 'students:mark_attendance' %}" class="btn btn-outline-primary btn-sm">Mark Attendance</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="bi bi-clock-history" style="font-size: 2.6rem; color: #ff9f1c;"></i>
                <h5 class="mt-3">Class Schedule</h5>
                <p class="text-muted mb-3">Check your weekly class timetable.</p>
                <a href="{% url 'academics:timetable' %}" class="btn btn-outline-primary btn-sm">View Schedule</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="bi bi-shield-lock" style="font-size: 2.6rem; color: var(--accent-color);"></i>
                <h5 class="mt-3">Change Password</h5>
                <p class="text-muted mb-3">Update your password securely.</p>
                <a href="{% url 'password_change' %}" class="btn btn-outline-primary btn-sm">Change Password</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block title %}Parent Portal - {{ user.school.name|default:"School Management System" }}{% endblock %}

{% block content %}    <div class="d-flex align-items-center justify-content-between mb-4 page-header">

<div class="container-fluid px-3 px-md-4 py-4">        <div>

    <!-- Header Section -->            <h1><i class="bi bi-person-hearts-fill me-2"></i>Parent Dashboard</h1>

    <div class="mb-5">            <p class="page-subtitle">Monitor your children's academic progress and performance</p>

        <div class="d-flex justify-content-between align-items-center mb-3">        </div>

            <div>        <div class="d-flex align-items-center" id="clock" style="font-size: 1.1rem; color: #7f8c8d; font-weight: 600;"></div>

                <h2 class="mb-1" style="font-weight: 700; color: #2c3e50;">    </div>

                    {% if user.school %}{{ user.school.name }} - {% endif %}Parent Portal

                </h2>    <!-- Quick Welcome Card -->

                <p class="text-muted mb-0">Welcome, {{ user.get_full_name }}!</p>    <div class="row g-3 mb-4">

            </div>        <div class="col-12">

        </div>            <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white;">

    </div>                <div class="card-body py-4">

                    <div class="d-flex align-items-center justify-content-between">

    <!-- Quick Stats -->                        <div>

    <div class="row g-3 mb-4">                            <h3 style="font-weight: 700; margin-bottom: 0.5rem;">Welcome, {{ user.get_full_name }}! ðŸ‘‹</h3>

        <div class="col-md-6 col-lg-3">                            <p class="mb-0" style="font-size: 0.95rem; opacity: 0.95;">Stay connected with your children's academic journey</p>

            <div class="card border-0 shadow-sm">                        </div>

                <div class="card-body">                        <i class="bi bi-person-circle" style="font-size: 3rem; opacity: 0.9;"></i>

                    <div class="d-flex justify-content-between align-items-center">                    </div>

                        <div>                </div>

                            <p class="text-muted small mb-1">My Children</p>            </div>

                            <h3 class="mb-0">{{ children_count|default:0 }}</h3>        </div>

                        </div>    </div>

                        <div style="font-size: 2rem; color: #007bff;">

                            <i class="bi bi-people"></i>    <!-- Quick Stats -->

                        </div>    <div class="row g-3 mb-4">

                    </div>        <div class="col-6 col-md-3">

                </div>            <div class="card stat-card border-left-primary h-100" style="border-left: 4px solid #3498db;">

            </div>                <div class="card-body py-3">

        </div>                    <div class="d-flex align-items-center justify-content-between">

                        <div>

        <div class="col-md-6 col-lg-3">                            <p class="stat-card-label">My Children</p>

            <div class="card border-0 shadow-sm">                            <h4 class="stat-card-value" id="childrenCount">0</h4>

                <div class="card-body">                        </div>

                    <div class="d-flex justify-content-between align-items-center">                        <div class="stat-icon bg-primary text-white">

                        <div>                            <i class="bi bi-people-fill"></i>

                            <p class="text-muted small mb-1">Average Grade</p>                        </div>

                            <h3 class="mb-0">{{ average_grade|default:"N/A" }}</h3>                    </div>

                        </div>                </div>

                        <div style="font-size: 2rem; color: #28a745;">            </div>

                            <i class="bi bi-star"></i>        </div>

                        </div>        <div class="col-6 col-md-3">

                    </div>            <div class="card stat-card border-left-success h-100" style="border-left: 4px solid #2ecc71;">

                </div>                <div class="card-body py-3">

            </div>                    <div class="d-flex align-items-center justify-content-between">

        </div>                        <div>

                            <p class="stat-card-label">Avg. Performance</p>

        <div class="col-md-6 col-lg-3">                            <h4 class="stat-card-value" id="avgPerformance">-</h4>

            <div class="card border-0 shadow-sm">                        </div>

                <div class="card-body">                        <div class="stat-icon bg-success text-white">

                    <div class="d-flex justify-content-between align-items-center">                            <i class="bi bi-graph-up-arrow"></i>

                        <div>                        </div>

                            <p class="text-muted small mb-1">Attendance Rate</p>                    </div>

                            <h3 class="mb-0">{{ attendance_rate|default:"N/A" }}</h3>                </div>

                        </div>            </div>

                        <div style="font-size: 2rem; color: #ffc107;">        </div>

                            <i class="bi bi-calendar-check"></i>        <div class="col-6 col-md-3">

                        </div>            <div class="card stat-card border-left-info h-100" style="border-left: 4px solid #1abc9c;">

                    </div>                <div class="card-body py-3">

                </div>                    <div class="d-flex align-items-center justify-content-between">

            </div>                        <div>

        </div>                            <p class="stat-card-label">Avg. Attendance</p>

                            <h4 class="stat-card-value" id="avgAttendance">-</h4>

        <div class="col-md-6 col-lg-3">                        </div>

            <div class="card border-0 shadow-sm">                        <div class="stat-icon bg-info text-white">

                <div class="card-body">                            <i class="bi bi-calendar-check-fill"></i>

                    <div class="d-flex justify-content-between align-items-center">                        </div>

                        <div>                    </div>

                            <p class="text-muted small mb-1">Unread Messages</p>                </div>

                            <h3 class="mb-0">{{ unread_messages|default:0 }}</h3>            </div>

                        </div>        </div>

                        <div style="font-size: 2rem; color: #dc3545;">        <div class="col-6 col-md-3">

                            <i class="bi bi-envelope"></i>            <div class="card stat-card border-left-warning h-100" style="border-left: 4px solid #f39c12;">

                        </div>                <div class="card-body py-3">

                    </div>                    <div class="d-flex align-items-center justify-content-between">

                </div>                        <div>

            </div>                            <p class="stat-card-label">Active Classes</p>

        </div>                            <h4 class="stat-card-value" id="activeClasses">-</h4>

    </div>                        </div>

                        <div class="stat-icon bg-warning text-white">

    <!-- Quick Actions -->                            <i class="bi bi-bookmark-fill"></i>

    <div class="row mb-4">                        </div>

        <div class="col-12">                    </div>

            <div class="card border-0 shadow-sm">                </div>

                <div class="card-body">            </div>

                    <h5 class="card-title mb-3">Quick Actions</h5>        </div>

                    <div class="d-flex flex-wrap gap-2">    </div>

                        <a href="{% url 'parents:my_children' %}" class="btn btn-primary btn-sm">

                            <i class="bi bi-people"></i> View My Children    <!-- Main Actions -->

                        </a>    <div class="row g-3 mb-4">

                        <a href="{% url 'messages:inbox' %}" class="btn btn-info btn-sm">        <div class="col-12 col-md-6">

                            <i class="bi bi-envelope"></i> Messages            <div class="card border-0 shadow-sm h-100">

                        </a>                <div class="card-body p-4">

                        <a href="{% url 'parents:child_details' %}" class="btn btn-secondary btn-sm">                    <div class="d-flex align-items-start">

                            <i class="bi bi-file-earmark"></i> Academic Details                        <div class="flex-grow-1">

                        </a>                            <h5 style="font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem;">

                        <button class="btn btn-warning btn-sm">                                <i class="bi bi-person-check-fill me-2" style="color: #3498db;"></i>View Children's Progress

                            <i class="bi bi-download"></i> Download Reports                            </h5>

                        </button>                            <p class="text-muted mb-3" style="font-size: 0.9rem;">

                    </div>                                Monitor attendance, grades, and academic performance for each of your children.

                </div>                            </p>

            </div>                            <a href="{% url 'parents:my_children' %}" class="btn btn-primary">

        </div>                                <i class="bi bi-arrow-right me-1"></i>View Details

    </div>                            </a>

                        </div>

    <!-- Main Content Sections -->                    </div>

    <div class="row">                </div>

        <div class="col-lg-8 mb-4">            </div>

            <div class="card border-0 shadow-sm">        </div>

                <div class="card-body">        <div class="col-12 col-md-6">

                    <h5 class="card-title mb-3">My Children</h5>            <div class="card border-0 shadow-sm h-100">

                    <div class="list-group list-group-flush">                <div class="card-body p-4">

                        {% if children %}                    <div class="d-flex align-items-start">

                            {% for child in children %}                        <div class="flex-grow-1">

                                <div class="list-group-item px-0 py-3">                            <h5 style="font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem;">

                                    <div class="d-flex justify-content-between align-items-center">                                <i class="bi bi-bell-fill me-2" style="color: #f39c12;"></i>Recent Updates

                                        <div>                            </h5>

                                            <h6 class="mb-0">{{ child.first_name }} {{ child.last_name }}</h6>                            <p class="text-muted mb-3" style="font-size: 0.9rem;">

                                            <small class="text-muted">{{ child.enrollment_number }} â€¢ {{ child.current_class }}</small>                                Stay updated with important school announcements and your child's activities.

                                        </div>                            </p>

                                        <a href="{% url 'parents:child_details' child.id %}" class="btn btn-sm btn-outline-primary">                            <div class="text-muted" style="font-size: 0.85rem;">

                                            View Details                                <i class="bi bi-info-circle me-1"></i>No recent updates at this time

                                        </a>                            </div>

                                    </div>                        </div>

                                </div>                    </div>

                            {% endfor %}                </div>

                        {% else %}            </div>

                            <div class="text-center text-muted py-4">        </div>

                                <i class="bi bi-inbox" style="font-size: 2rem; opacity: 0.5;"></i>    </div>

                                <p class="mt-2 mb-0">No children linked to your account</p>

                            </div>    <!-- Footer Note -->

                        {% endif %}    <div class="alert alert-info border-0 border-left-info" style="border-left: 4px solid #1abc9c;">

                    </div>        <i class="bi bi-info-circle me-2"></i>

                </div>        For more details about your children's progress, please visit the "My Children" section or contact the school directly.

            </div>    </div>

        </div></div>



        <div class="col-lg-4 mb-4"><script>

            <div class="card border-0 shadow-sm">// Clock function

                <div class="card-body">function updateClock() {

                    <h5 class="card-title mb-3">Recent Notifications</h5>    const now = new Date();

                    <div class="list-group list-group-flush">    const hours = String(now.getHours()).padStart(2, '0');

                        <div class="list-group-item px-0 py-2">    const minutes = String(now.getMinutes()).padStart(2, '0');

                            <small class="text-muted d-block">No new notifications</small>    const seconds = String(now.getSeconds()).padStart(2, '0');

                        </div>    document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;

                    </div>}

                </div>

            </div>// Update clock immediately and then every second

updateClock();

            <div class="card border-0 shadow-sm mt-3">setInterval(updateClock, 1000);

                <div class="card-body">

                    <h5 class="card-title mb-3">Important Links</h5>// Initialize stats if they're passed from the view

                    <div class="list-group list-group-flush">document.addEventListener('DOMContentLoaded', function() {

                        <a href="{% url 'parents:my_children' %}" class="list-group-item list-group-item-action px-0 py-2">    // These would be populated by the backend if needed

                            <i class="bi bi-arrow-right me-2"></i> View Children's Progress    const statsData = JSON.parse(document.body.getAttribute('data-stats') || '{}');

                        </a>    

                        <a href="{% url 'messages:inbox' %}" class="list-group-item list-group-item-action px-0 py-2">    if (statsData.children_count) {

                            <i class="bi bi-arrow-right me-2"></i> Contact Teachers        document.getElementById('childrenCount').textContent = statsData.children_count;

                        </a>    }

                    </div>    if (statsData.avg_performance) {

                </div>        document.getElementById('avgPerformance').textContent = statsData.avg_performance + '%';

            </div>    }

        </div>    if (statsData.avg_attendance) {

    </div>        document.getElementById('avgAttendance').textContent = statsData.avg_attendance + '%';

</div>    }

    if (statsData.active_classes) {

<style>        document.getElementById('activeClasses').textContent = statsData.active_classes;

    .card {    }

        transition: transform 0.2s, box-shadow 0.2s;});

    }</script>

    .card:hover {{% endblock %}
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
    }
</style>
{% endblock %}

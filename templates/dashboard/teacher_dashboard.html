{% extends 'base.html' %}{% extends 'base.html' %}

{% load static %}{% load dashboard_extras %}



{% block title %}Teacher Dashboard - {{ user.school.name|default:"School Management System" }}{% endblock %}{% block title %}Teacher Dashboard - {{ user.school.name|default:"Asetena Management System" }}{% endblock %}



{% block content %}{% block content %}

<div class="container-fluid px-3 px-md-4 py-4"><div class="container-fluid px-3 px-md-4 py-4">

    <!-- Header Section -->    <!-- Header Section -->

    <div class="mb-5">    <div class="mb-4">

        <div class="d-flex justify-content-between align-items-center mb-3">        <h2 class="mb-1" style="font-weight: 700; color: #2c3e50;">

            <div>            {% if user.school %}{{ user.school.name }} - {% endif %}Teacher Dashboard

                <h2 class="mb-1" style="font-weight: 700; color: #2c3e50;">        </h2>

                    {% if user.school %}{{ user.school.name }} - {% endif %}Teacher Dashboard        <p class="text-muted mb-0">Manage your classes and view performance metrics</p>

                </h2>    </div>

                <p class="text-muted mb-0">Welcome back, {{ user.get_full_name }}!</p>

            </div>    <!-- Statistics Cards -->

        </div>    <div class="row g-3 mb-4">

    </div>        <div class="col-6 col-md-3">

            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #3498db;">

    <!-- Quick Stats -->                <div class="card-body py-3">

    <div class="row g-3 mb-4">                    <div class="d-flex align-items-center justify-content-between">

        <div class="col-md-6 col-lg-3">                        <div>

            <div class="card border-0 shadow-sm">                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Students</p>

                <div class="card-body">                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ students_taught }}</h4>

                    <div class="d-flex justify-content-between align-items-center">                        </div>

                        <div>                        <div class="stat-icon bg-primary text-white">

                            <p class="text-muted small mb-1">My Classes</p>                            <i class="bi bi-people-fill" style="font-size: 1.5rem;"></i>

                            <h3 class="mb-0">{{ teacher_classes_count|default:0 }}</h3>                        </div>

                        </div>                    </div>

                        <div style="font-size: 2rem; color: #007bff;">                </div>

                            <i class="bi bi-people"></i>            </div>

                        </div>        </div>

                    </div>        <div class="col-6 col-md-3">

                </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #2ecc71;">

            </div>                <div class="card-body py-3">

        </div>                    <div class="d-flex align-items-center justify-content-between">

                        <div>

        <div class="col-md-6 col-lg-3">                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Classes</p>

            <div class="card border-0 shadow-sm">                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ total_classes_taught }}</h4>

                <div class="card-body">                        </div>

                    <div class="d-flex justify-content-between align-items-center">                        <div class="stat-icon bg-success text-white">

                        <div>                            <i class="bi bi-book-fill" style="font-size: 1.5rem;"></i>

                            <p class="text-muted small mb-1">Total Students</p>                        </div>

                            <h3 class="mb-0">{{ total_students|default:0 }}</h3>                    </div>

                        </div>                </div>

                        <div style="font-size: 2rem; color: #28a745;">            </div>

                            <i class="bi bi-person-check"></i>        </div>

                        </div>        <div class="col-6 col-md-3">

                    </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #f39c12;">

                </div>                <div class="card-body py-3">

            </div>                    <div class="d-flex align-items-center justify-content-between">

        </div>                        <div>

                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Subjects</p>

        <div class="col-md-6 col-lg-3">                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ total_subjects_taught }}</h4>

            <div class="card border-0 shadow-sm">                        </div>

                <div class="card-body">                        <div class="stat-icon bg-warning text-white">

                    <div class="d-flex justify-content-between align-items-center">                            <i class="bi bi-mortarboard-fill" style="font-size: 1.5rem;"></i>

                        <div>                        </div>

                            <p class="text-muted small mb-1">Subjects Teaching</p>                    </div>

                            <h3 class="mb-0">{{ subject_count|default:0 }}</h3>                </div>

                        </div>            </div>

                        <div style="font-size: 2rem; color: #ffc107;">        </div>

                            <i class="bi bi-book"></i>        <div class="col-6 col-md-3">

                        </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #e74c3c;">

                    </div>                <div class="card-body py-3">

                </div>                    <a href="{% url 'teachers:enter_grades' %}" class="text-decoration-none">

            </div>                        <div class="d-flex align-items-center justify-content-between">

        </div>                            <div>

                                <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Actions</p>

        <div class="col-md-6 col-lg-3">                                <h6 class="mb-0" style="font-weight: 700; color: #e74c3c;">Enter Grades</h6>

            <div class="card border-0 shadow-sm">                            </div>

                <div class="card-body">                            <div class="stat-icon bg-danger text-white">

                    <div class="d-flex justify-content-between align-items-center">                                <i class="bi bi-pencil-fill" style="font-size: 1.5rem;"></i>

                        <div>                            </div>

                            <p class="text-muted small mb-1">Pending Tasks</p>                        </div>

                            <h3 class="mb-0">{{ pending_tasks|default:0 }}</h3>                    </a>

                        </div>                </div>

                        <div style="font-size: 2rem; color: #dc3545;">            </div>

                            <i class="bi bi-exclamation-circle"></i>        </div>

                        </div>    </div>

                    </div>

                </div>    <!-- Charts Row -->

            </div>    <div class="row g-4 mb-4">

        </div>        {% if has_grades %}

    </div>        <div class="col-lg-6">

            <div class="card h-100 border-0 shadow-sm">

    <!-- Quick Actions -->                <div class="card-header bg-primary text-white py-3">

    <div class="row mb-4">                    <h6 class="mb-0" style="font-weight: 600;">

        <div class="col-12">                        <i class="bi bi-pie-chart-fill me-2"></i>Grade Distribution

            <div class="card border-0 shadow-sm">                    </h6>

                <div class="card-body">                </div>

                    <h5 class="card-title mb-3">Quick Actions</h5>                <div class="card-body p-3">

                    <div class="d-flex flex-wrap gap-2">                    <div style="position: relative; height: 250px; max-width: 250px; margin: 0 auto;">

                        <a href="{% url 'teachers:enter_grades' %}" class="btn btn-primary btn-sm">                        <canvas id="gradeChart"></canvas>

                            <i class="bi bi-pencil"></i> Enter Grades                    </div>

                        </a>                </div>

                        <a href="{% url 'teachers:mark_attendance' %}" class="btn btn-info btn-sm">            </div>

                            <i class="bi bi-check-circle"></i> Mark Attendance        </div>

                        </a>        {% endif %}

                        <a href="{% url 'teachers:teacher_list' %}" class="btn btn-secondary btn-sm">        

                            <i class="bi bi-list-ul"></i> View My Classes        {% if has_subjects %}

                        </a>        <div class="col-lg-6">

                        <a href="{% url 'messages:inbox' %}" class="btn btn-warning btn-sm">            <div class="card h-100 border-0 shadow-sm">

                            <i class="bi bi-envelope"></i> Messages                <div class="card-header bg-success text-white py-3">

                        </a>                    <h6 class="mb-0" style="font-weight: 600;">

                    </div>                        <i class="bi bi-bar-chart-fill me-2"></i>Subject Performance

                </div>                    </h6>

            </div>                </div>

        </div>                <div class="card-body p-3">

    </div>                    <div style="position: relative; height: 250px;">

                        <canvas id="subjectChart"></canvas>

    <!-- Main Content Sections -->                    </div>

    <div class="row">                </div>

        <div class="col-lg-8 mb-4">            </div>

            <div class="card border-0 shadow-sm">        </div>

                <div class="card-body">        {% endif %}

                    <h5 class="card-title mb-3">Recent Activities</h5>    </div>

                    <div class="text-center text-muted py-4">

                        <i class="bi bi-inbox" style="font-size: 2rem; opacity: 0.5;"></i>    <!-- Schedule Section -->

                        <p class="mt-2 mb-0">No recent activities</p>    <div class="row">

                    </div>        <div class="col-12">

                </div>            <div class="card border-0 shadow-sm">

            </div>                <div class="card-header bg-info text-white py-3">

        </div>                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">

                        <h6 class="mb-0" style="font-weight: 600;">

        <div class="col-lg-4 mb-4">                            <i class="bi bi-calendar-week me-2"></i>{{ selected_day_label|default:"Today's" }} Schedule

            <div class="card border-0 shadow-sm">                        </h6>

                <div class="card-body">                        <div class="btn-group btn-group-sm" role="group">

                    <h5 class="card-title mb-3">Attendance Summary</h5>                            {% for day_code, day_label in days %}

                    <div class="list-group list-group-flush">                                <a href="?day={{ day_code }}"

                        <div class="list-group-item px-0 py-2">                                   class="btn {% if day_code == selected_day %}btn-light text-info{% else %}btn-outline-light{% endif %}"

                            <span class="text-muted">Today's Attendance</span>                                   style="font-size: 0.85rem;">

                            <span class="badge bg-success float-end">Pending</span>                                    {{ day_label|slice:":3" }}

                        </div>                                </a>

                        <div class="list-group-item px-0 py-2">                            {% endfor %}

                            <span class="text-muted">This Week</span>                        </div>

                            <span class="badge bg-info float-end">View</span>                    </div>

                        </div>                </div>

                        <div class="list-group-item px-0 py-2">                <div class="card-body p-0">

                            <span class="text-muted">This Month</span>                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">

                            <span class="badge bg-secondary float-end">Report</span>                        <table class="table table-hover mb-0" style="font-size: 0.9rem;">

                        </div>                            <thead class="table-light sticky-top">

                    </div>                                <tr>

                </div>                                    <th style="width: 15%; font-weight: 600;">Time</th>

            </div>                                    <th style="font-weight: 600;">Class</th>

        </div>                                    <th style="font-weight: 600;">Subject</th>

    </div>                                </tr>

</div>                            </thead>

                            <tbody>

<style>                                {% for time_slot in time_slots %}

    .card {                                    {% with day_classes=time_slot.classes|get_item:selected_day %}

        transition: transform 0.2s, box-shadow 0.2s;                                    <tr>

    }                                        <td class="fw-600" style="background-color: #f8f9fa;">{{ time_slot.label }}</td>

    .card:hover {                                        <td colspan="2" {% if day_classes %}class="table-light"{% endif %}>

        transform: translateY(-2px);                                            {% if day_classes %}

        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;                                                {% for class in day_classes %}

    }                                                    <div class="d-flex justify-content-between align-items-center py-2">

</style>                                                        <span><strong>{{ class.class_name }}</strong></span>

{% endblock %}                                                        <span class="badge bg-info">{{ class.subject }}</span>

                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <span class="text-muted">No class scheduled</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endwith %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stat-icon {
        width: 45px;
        height: 45px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .stat-card {
        transition: all 0.2s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12) !important;
    }

    .btn-group-sm .btn {
        padding: 0.4rem 0.8rem;
    }

    @media (max-width: 768px) {
        .container-fluid {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        .btn-group .btn {
            font-size: 0.75rem !important;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Grade Distribution Chart
        const gradeCtx = document.getElementById('gradeChart');
        if (gradeCtx) {
            const gradeLabels = {{ grade_labels|safe }};
            const gradeCounts = {{ grade_counts|safe }};
            
            if (gradeLabels && gradeLabels.length > 0) {
                const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384'];
                const backgroundColors = colors.slice(0, gradeLabels.length);
                
                new Chart(gradeCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: gradeLabels,
                        datasets: [{
                            data: gradeCounts,
                            backgroundColor: backgroundColors,
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: { size: 12 }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Subject Performance Chart
        const subjectCtx = document.getElementById('subjectChart');
        if (subjectCtx) {
            const subjectNames = {{ subject_names|safe }};
            const avgMarks = {{ avg_marks|safe }};
            
            if (subjectNames && subjectNames.length > 0) {
                new Chart(subjectCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: subjectNames,
                        datasets: [{
                            label: 'Avg Marks',
                            data: avgMarks,
                            backgroundColor: '#36A2EB',
                            borderColor: '#1e7e8b',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }
    });
</script>
{% endblock %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Card - {{ student.user.get_full_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        @media print {
            .no-print { display: none !important; }
            body { 
                background: white !important; 
                padding: 0 !important; 
                margin: 0 !important;
                font-size: 10px !important;
            }
            .report-card { 
                box-shadow: none !important; 
                margin: 0 !important;
                border: 2px solid #000 !important;
                max-width: none !important;
            }
            .table { font-size: 9px !important; }
        }

        body {
            background: #f8f9fa;
            padding: 20px;
            font-family: Arial, sans-serif;
            font-size: 12px;
        }

        .no-print {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .report-card {
            background: white;
            max-width: 1000px;
            margin: 0 auto;
            border: 2px solid #000;
            border-radius: 0;
            box-shadow: none;
            position: relative;
        }

        .report-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000;
        }

        .report-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000;
        }

        /* Header Section */
        .header-section {
            background: #1e40af;
            color: white;
            padding: 10px 20px;
            border-bottom: 2px solid #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            flex: 1;
            margin: 0;
        }

        .header-school {
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            width: 100%;
            margin: 5px 0 0 0;
        }

        .header-contact {
            font-size: 10px;
            text-align: center;
            width: 100%;
            margin: 0;
        }

        /* Main Title */
        .main-title {
            background: #1e40af;
            color: white;
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #000;
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }

        /* Student Photo Placeholder */
        .photo-placeholder {
            width: 80px;
            height: 100px;
            background: #e5e7eb;
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-size: 10px;
            text-align: center;
            margin: 0 auto;
        }

        /* Student Info Table */
        .student-info-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
            margin-bottom: 10px;
            font-size: 11px;
        }

        .student-info-table th,
        .student-info-table td {
            border: 1px solid #000;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
        }

        .student-info-table th {
            background: #f3f4f6;
            font-weight: bold;
        }

        /* Grades Table */
        .grades-section {
            padding: 15px;
            border: 1px solid #000;
        }

        .grades-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .grades-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
            font-size: 10px;
        }

        .grades-table th,
        .grades-table td {
            border: 1px solid #000;
            padding: 4px 6px;
            text-align: center;
            vertical-align: middle;
        }

        .grades-table th {
            background: #1e40af;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 9px;
        }

        .grades-table tbody tr:hover {
            background: #f9fafb;
        }

        .subject-name {
            text-align: left !important;
            font-weight: bold;
        }

        .grade-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            color: white;
            display: inline-block;
            min-width: 25px;
            text-align: center;
        }

        .grade-A { background: #059669; }
        .grade-B { background: #3b82f6; }
        .grade-C { background: #d97706; }
        .grade-D, .grade-F { background: #dc2626; }

        /* Summary Section */
        .summary-section {
            padding: 15px;
            border: 1px solid #000;
            margin: 10px 0;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
            font-size: 10px;
        }

        .summary-table th,
        .summary-table td {
            border: 1px solid #000;
            padding: 6px;
            text-align: center;
        }

        .summary-table th {
            background: #f3f4f6;
            font-weight: bold;
        }

        /* Attendance Table */
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
            font-size: 10px;
            margin: 10px 0;
        }

        .attendance-table th,
        .attendance-table td {
            border: 1px solid #000;
            padding: 4px 6px;
            text-align: center;
        }

        .attendance-table th {
            background: #1e40af;
            color: white;
            font-weight: bold;
        }

        /* Remarks Section */
        .remarks-section {
            padding: 15px;
            border: 1px solid #000;
            margin: 10px 0;
        }

        .remarks-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .remarks-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
            font-size: 9px;
        }

        .remarks-table th,
        .remarks-table td {
            border: 1px solid #000;
            padding: 4px 8px;
            vertical-align: top;
        }

        .remarks-table th {
            background: #f3f4f6;
            font-weight: bold;
            width: 25%;
        }

        .remarks-table td {
            text-align: left;
        }

        /* Signature Section */
        .signature-section {
            padding: 20px 15px;
            border-top: 2px solid #000;
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
        }

        .signature-box {
            flex: 1;
            border: 1px solid #000;
            padding: 15px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .signature-title {
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 10px;
        }

        .signature-line {
            border-top: 1px solid #000;
            margin: 10px 0;
            padding-top: 5px;
            font-size: 10px;
        }

        /* Footer */
        .footer {
            border-top: 1px solid #000;
            padding: 10px;
            text-align: center;
            font-size: 9px;
            color: #374151;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                text-align: center;
            }
            
            .signature-section {
                flex-direction: column;
                gap: 15px;
            }
            
            .grades-table, .remarks-table {
                font-size: 8px;
            }
            
            .grades-table th,
            .grades-table td {
                padding: 2px 4px;
            }
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button onclick="window.print()" class="btn btn-primary me-3">
            <i class="bi bi-printer"></i> Print Report Card
        </button>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <div class="report-card">
        <!-- Header Section -->
        <div class="header-section">
            <div>
                <div class="header-title">GHANA EDUCATION SERVICE</div>
                <div class="header-school">DABOYA GIRLS MODEL JUNIOR HIGH SCHOOL</div>
                <div class="header-contact">P.O. Box 6, Daboya, North Gonja District</div>
                <div class="header-contact">Tel: 024-0852910</div>
            </div> <span>
                {% comment %} <div class="photo-placeholder">
                <div>Student</div>
                <div>Photo</div>
            </div> {% endcomment %}
            </span>

            
        </div>

        <!-- Main Title -->
        <div class="main-title">LEARNER'S REPORT SHEET</div>

        <!-- Student Information -->
        <table class="student-info-table">
            <tr>
                <th style="width: 15%;">NAME</th>
                <th style="width: 20%;">CLASS</th>
                <th style="width: 15%;">GENDER</th>
                <th style="width: 20%;">NO. ON ROLL</th>
                <th style="width: 30%;">NEXT TERM BEGINS</th>
            </tr>
            <tr>
                <td>{{ student.user.get_full_name }}</td>
                <td>{{ student.current_class|slice:":2" }}</td>
                <td>{{ student.get_gender_display }}</td>
                <td>{{ student.admission_number }}</td>
                <td>{{ report_date|date:"d/m/Y" }}</td>
            </tr>
        </table>

        <table class="student-info-table">
            <tr>
                <th style="width: 15%;">VAC DATE</th>
                <th style="width: 25%;">TERM</th>
                <th style="width: 20%;">YEAR</th>
                <th style="width: 20%;">ADMISSION NO</th>
                <th style="width: 20%;">POSITION</th>
            </tr>
            <tr>
                <td>{{ report_date|date:"d/m/Y" }}</td>
                <td>{{ term_display }}</td>
                <td>{{ academic_year.name }}</td>
                <td>{{ student.admission_number }}</td>
                <td>{{ student.roll_number|default:"-" }}</td>
            </tr>
        </table>

        <!-- Grades Section -->
<div class="grades-section">
    <div class="grades-title">
        <i class="bi bi-clipboard-data"></i> SUBJECT ASSESSMENT
    </div>
    
    {% if grades %}
    <table class="grades-table">
        <thead>
            <tr>
                <th>SN</th>
                <th>SUBJECT</th>
                <th>CLASS<br>WORK<br>(30)</th>
                <th>EXAM<br>(70)</th>
                <th>TOTAL<br>(100)</th>
                <th>RANK</th>
                <th>GD</th>
                <th>REMARKS</th>
            </tr>
        </thead>
        <tbody>
            {% for grade in grades %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td class="subject-name">{{ grade.subject.name }}</td>
                <td>{{ grade.class_score }}</td>
                <td>{{ grade.exams_score }}</td>
                <td><strong>{{ grade.total_score }}</strong></td>
                <td>{{ grade.subject_position|default:"-" }}</td>
                <td>
                    <span class="grade-badge 
                        {% if grade.grade == '1' %}bg-success
                        {% elif grade.grade == '2' %}bg-primary
                        {% elif grade.grade == '3' or grade.grade == '4' %}bg-info
                        {% elif grade.grade == '5' or grade.grade == '6' %}bg-warning text-dark
                        {% else %}bg-danger{% endif %}">
                        {{ grade.grade }}
                    </span>
                </td>
                <td>{{ grade.remarks }}</td>
            </tr>
            {% endfor %}
            
            <!-- Totals Row -->
            <tr style="background: #f3f4f6; font-weight: bold;">
                <td colspan="2"><strong>TOTAL / AVERAGE</strong></td>
                <td>{{ total_class_work|floatformat:1 }}</td>
                <td>{{ total_exams|floatformat:1 }}</td>
                <td><strong>{{ grand_total|floatformat:1 }}</strong></td>
                <td>{{ class_position|default:"-" }}</td>
                <td>
                    <span class="grade-badge 
                        {% if overall_grade == '1' %}bg-success
                        {% elif overall_grade == '2' %}bg-primary
                        {% elif overall_grade == '3' or overall_grade == '4' %}bg-info
                        {% elif overall_grade == '5' or overall_grade == '6' %}bg-warning text-dark
                        {% else %}bg-danger{% endif %}">
                        {{ overall_grade|default:'-' }}
                    </span>
                </td>
                <td>{{ overall_remarks }}</td>
            </tr>
        </tbody>
    </table>
    
    <!-- Grading Scale Legend -->
    <div style="margin-top: 15px; padding: 10px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 4px;">
        <div style="font-weight: bold; margin-bottom: 5px; font-size: 10px;">GRADING SCALE:</div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px; font-size: 9px;">
            <span><span class="grade-badge bg-success">1</span> = 80-100% (Highest)</span>
            <span><span class="grade-badge bg-primary">2</span> = 70-79% (Higher)</span>
            <span><span class="grade-badge bg-info">3</span> = 65-69% (High)</span>
            <span><span class="grade-badge bg-info">4</span> = 60-64% (High Average)</span>
            <span><span class="grade-badge bg-warning text-dark">5</span> = 55-59% (Average)</span>
            <span><span class="grade-badge bg-warning text-dark">6</span> = 50-54% (Low Average)</span>
            <span><span class="grade-badge bg-danger">7</span> = 45-49% (Low)</span>
            <span><span class="grade-badge bg-danger">8</span> = 40-44% (Lower)</span>
            <span><span class="grade-badge bg-danger">9</span> = 0-39% (Lowest)</span>
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-journal-text" style="font-size: 2rem; margin-bottom: 10px;"></i>
        <p>No grades available for this term</p>
    </div>
    {% endif %}
</div>

        <!-- Attendance Summary -->
        <div class="summary-section">
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>ATTENDANCE</th>
                        <th>PRESENT</th>
                        <th>ABSENT</th>
                        <th>LATE</th>
                        <th>ATTENDANCE %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>{{ attendance_stats.present|add:attendance_stats.absent|add:attendance_stats.late }}</strong></td>
                        <td><strong>{{ attendance_stats.present }}</strong></td>
                        <td><strong>{{ attendance_stats.absent }}</strong></td>
                        <td><strong>{{ attendance_stats.late }}</strong></td>
                        <td><strong>{{ attendance_stats.percentage }}%</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Overall Summary -->
        <div class="summary-section">
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>ASSESSMENT</th>
                        <th>OUT OF</th>
                        <th>ACHIEVED</th>
                        <th>COMMENT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>TOTAL SUBJECTS</strong></td>
                        <td>{{ total_subjects }}</td>
                        <td>{{ total_subjects }}</td>
                        <td>Completed</td>
                    </tr>
                    <tr>
                        <td><strong>AVERAGE %</strong></td>
                        <td>100%</td>
                        <td>{{ average_percentage|floatformat:1 }}%</td>
                        <td>{{ overall_grade }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Remarks Section -->
        <div class="remarks-section">
            <div class="remarks-title">
                <i class="bi bi-chat-text"></i> TEACHER'S REMARKS
            </div>
            <table class="remarks-table">
                <thead>
                    <tr>
                        <th>ASSESSMENT AREA</th>
                        <th>SCORE</th>
                        <th>COMMENT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Overall Performance</td>
                        <td>{{ average_percentage|floatformat:0 }}%</td>
                        <td>
                            {% if average_percentage >= 80 %}
                                Excellent performance. Continue to maintain high standards.
                            {% elif average_percentage >= 60 %}
                                Good performance. Maintain consistency and strive for excellence.
                            {% elif average_percentage >= 40 %}
                                Fair performance. More effort required to improve results.
                            {% else %}
                                Needs improvement. Additional support and study required.
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Class Participation</td>
                        <td>{{ attendance_stats.percentage }}%</td>
                        <td>
                            {% if attendance_stats.percentage >= 90 %}
                                Excellent attendance record.
                            {% elif attendance_stats.percentage >= 75 %}
                                Good attendance. Maintain consistency.
                            {% elif attendance_stats.percentage >= 50 %}
                                Fair attendance. Improve regularity.
                            {% else %}
                                Poor attendance. Requires improvement.
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>General Conduct</td>
                        <td>-</td>
                        <td>
                            {% if remarks %}
                                {{ remarks|truncatechars:100 }}
                            {% else %}
                                Good conduct and behavior observed.
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Signature Section -->
        <div class="signature-section">
            <div class="signature-box">
                <div class="signature-title">CLASS TEACHER'S SIGNATURE & STAMP</div>
                <div class="signature-line">_______________________________</div>
                <div style="font-size: 9px; margin-top: auto;">Date: {{ report_date|date:"d/m/Y" }}</div>
            </div>
            
            <div class="signature-box">
                <div class="signature-title">HEAD TEACHER'S SIGNATURE & STAMP</div>
                <div class="signature-line">_______________________________</div>
                <div style="font-size: 9px; margin-top: auto;">Date: {{ report_date|date:"d/m/Y" }}</div>
            </div>
            
            <div class="signature-box">
                <div class="signature-title">PARENT/GUARDIAN'S SIGNATURE</div>
                <div class="signature-line">_______________________________</div>
                <div style="font-size: 9px; margin-top: auto;">Date: __________</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Generated on {{ report_date|date:"d/m/Y" }} | School Management System
        </div>
    </div>

    <script>
        // Print functionality
        document.querySelector('.btn-primary').addEventListener('click', function() {
            window.print();
        });

        // Add print styles for better table formatting
        window.addEventListener('beforeprint', function() {
            document.body.style.fontSize = '10px';
        });

        window.addEventListener('afterprint', function() {
            document.body.style.fontSize = '';
        });
    </script>
</body>
</html>
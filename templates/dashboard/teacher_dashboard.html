{% extends 'base.html' %}{% extends 'base.html' %}

{% load static %}{% load static %}



{% block title %}Teacher Dashboard - {{ user.school.name|default:"School Management System" }}{% endblock %}{% block title %}Teacher Dashboard - {{ user.school.name|default:"School Management System" }}{% endblock %}



{% block content %}{% block content %}

<div class="container-fluid px-3 px-md-4 py-4">

    <!-- Header Section --><div class="container-fluid px-3 px-md-4 py-4"><div class="container-fluid px-3 px-md-4 py-4">

    <div class="mb-4">

        <h2 class="mb-1" style="font-weight: 700; color: #2c3e50;">    <!-- Header Section -->    <!-- Header Section -->

            {% if user.school %}{{ user.school.name }} - {% endif %}Teacher Dashboard

        </h2>    <div class="mb-5">    <div class="mb-4">

        <p class="text-muted mb-0">Manage your classes and view performance metrics</p>

    </div>        <div class="d-flex justify-content-between align-items-center mb-3">        <h2 class="mb-1" style="font-weight: 700; color: #2c3e50;">



    <!-- Statistics Cards -->            <div>            {% if user.school %}{{ user.school.name }} - {% endif %}Teacher Dashboard

    <div class="row g-3 mb-4">

        <div class="col-6 col-md-3">                <h2 class="mb-1" style="font-weight: 700; color: #2c3e50;">        </h2>

            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #3498db;">

                <div class="card-body py-3">                    {% if user.school %}{{ user.school.name }} - {% endif %}Teacher Dashboard        <p class="text-muted mb-0">Manage your classes and view performance metrics</p>

                    <div class="d-flex align-items-center justify-content-between">

                        <div>                </h2>    </div>

                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Students</p>

                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ students_taught }}</h4>                <p class="text-muted mb-0">Welcome back, {{ user.get_full_name }}!</p>

                        </div>

                        <div class="stat-icon bg-primary text-white">            </div>    <!-- Statistics Cards -->

                            <i class="bi bi-people-fill" style="font-size: 1.5rem;"></i>

                        </div>        </div>    <div class="row g-3 mb-4">

                    </div>

                </div>    </div>        <div class="col-6 col-md-3">

            </div>

        </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #3498db;">

        <div class="col-6 col-md-3">

            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #2ecc71;">    <!-- Quick Stats -->                <div class="card-body py-3">

                <div class="card-body py-3">

                    <div class="d-flex align-items-center justify-content-between">    <div class="row g-3 mb-4">                    <div class="d-flex align-items-center justify-content-between">

                        <div>

                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Classes</p>        <div class="col-md-6 col-lg-3">                        <div>

                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ total_classes_taught }}</h4>

                        </div>            <div class="card border-0 shadow-sm">                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Students</p>

                        <div class="stat-icon bg-success text-white">

                            <i class="bi bi-book-fill" style="font-size: 1.5rem;"></i>                <div class="card-body">                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ students_taught }}</h4>

                        </div>

                    </div>                    <div class="d-flex justify-content-between align-items-center">                        </div>

                </div>

            </div>                        <div>                        <div class="stat-icon bg-primary text-white">

        </div>

        <div class="col-6 col-md-3">                            <p class="text-muted small mb-1">My Classes</p>                            <i class="bi bi-people-fill" style="font-size: 1.5rem;"></i>

            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #f39c12;">

                <div class="card-body py-3">                            <h3 class="mb-0">{{ teacher_classes_count|default:0 }}</h3>                        </div>

                    <div class="d-flex align-items-center justify-content-between">

                        <div>                        </div>                    </div>

                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Subjects</p>

                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ total_subjects_taught }}</h4>                        <div style="font-size: 2rem; color: #007bff;">                </div>

                        </div>

                        <div class="stat-icon bg-warning text-white">                            <i class="bi bi-people"></i>            </div>

                            <i class="bi bi-mortarboard-fill" style="font-size: 1.5rem;"></i>

                        </div>                        </div>        </div>

                    </div>

                </div>                    </div>        <div class="col-6 col-md-3">

            </div>

        </div>                </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #2ecc71;">

        <div class="col-6 col-md-3">

            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #e74c3c;">            </div>                <div class="card-body py-3">

                <div class="card-body py-3">

                    <a href="{% url 'teachers:enter_grades' %}" class="text-decoration-none">        </div>                    <div class="d-flex align-items-center justify-content-between">

                        <div class="d-flex align-items-center justify-content-between">

                            <div>                        <div>

                                <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Actions</p>

                                <h6 class="mb-0" style="font-weight: 700; color: #e74c3c;">Enter Grades</h6>        <div class="col-md-6 col-lg-3">                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Classes</p>

                            </div>

                            <div class="stat-icon bg-danger text-white">            <div class="card border-0 shadow-sm">                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ total_classes_taught }}</h4>

                                <i class="bi bi-pencil-fill" style="font-size: 1.5rem;"></i>

                            </div>                <div class="card-body">                        </div>

                        </div>

                    </a>                    <div class="d-flex justify-content-between align-items-center">                        <div class="stat-icon bg-success text-white">

                </div>

            </div>                        <div>                            <i class="bi bi-book-fill" style="font-size: 1.5rem;"></i>

        </div>

    </div>                            <p class="text-muted small mb-1">Total Students</p>                        </div>



    <!-- Charts Row -->                            <h3 class="mb-0">{{ total_students|default:0 }}</h3>                    </div>

    <div class="row g-4 mb-4">

        {% if has_grades %}                        </div>                </div>

        <div class="col-lg-6">

            <div class="card h-100 border-0 shadow-sm">                        <div style="font-size: 2rem; color: #28a745;">            </div>

                <div class="card-header bg-primary text-white py-3">

                    <h6 class="mb-0" style="font-weight: 600;">                            <i class="bi bi-person-check"></i>        </div>

                        <i class="bi bi-pie-chart-fill me-2"></i>Grade Distribution

                    </h6>                        </div>        <div class="col-6 col-md-3">

                </div>

                <div class="card-body p-3">                    </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #f39c12;">

                    <div style="position: relative; height: 250px; max-width: 250px; margin: 0 auto;">

                        <canvas id="gradeChart"></canvas>                </div>                <div class="card-body py-3">

                    </div>

                </div>            </div>                    <div class="d-flex align-items-center justify-content-between">

            </div>

        </div>        </div>                        <div>

        {% endif %}

                            <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Subjects</p>

        {% if has_subjects %}

        <div class="col-lg-6">        <div class="col-md-6 col-lg-3">                            <h4 class="mb-0" style="font-weight: 700; color: #2c3e50;">{{ total_subjects_taught }}</h4>

            <div class="card h-100 border-0 shadow-sm">

                <div class="card-header bg-success text-white py-3">            <div class="card border-0 shadow-sm">                        </div>

                    <h6 class="mb-0" style="font-weight: 600;">

                        <i class="bi bi-bar-chart-fill me-2"></i>Subject Performance                <div class="card-body">                        <div class="stat-icon bg-warning text-white">

                    </h6>

                </div>                    <div class="d-flex justify-content-between align-items-center">                            <i class="bi bi-mortarboard-fill" style="font-size: 1.5rem;"></i>

                <div class="card-body p-3">

                    <div style="position: relative; height: 250px;">                        <div>                        </div>

                        <canvas id="subjectChart"></canvas>

                    </div>                            <p class="text-muted small mb-1">Subjects Teaching</p>                    </div>

                </div>

            </div>                            <h3 class="mb-0">{{ subject_count|default:0 }}</h3>                </div>

        </div>

        {% endif %}                        </div>            </div>

    </div>

                        <div style="font-size: 2rem; color: #ffc107;">        </div>

    <!-- Schedule Section -->

    <div class="row">                            <i class="bi bi-book"></i>        <div class="col-6 col-md-3">

        <div class="col-12">

            <div class="card border-0 shadow-sm">                        </div>            <div class="card stat-card h-100 border-0 shadow-sm" style="border-left: 4px solid #e74c3c;">

                <div class="card-header bg-info text-white py-3">

                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">                    </div>                <div class="card-body py-3">

                        <h6 class="mb-0" style="font-weight: 600;">

                            <i class="bi bi-calendar-week me-2"></i>Schedule                </div>                    <a href="{% url 'teachers:enter_grades' %}" class="text-decoration-none">

                        </h6>

                        <div class="btn-group btn-group-sm" role="group">            </div>                        <div class="d-flex align-items-center justify-content-between">

                            <button type="button" class="btn btn-light text-info">Mon</button>

                            <button type="button" class="btn btn-outline-light">Tue</button>        </div>                            <div>

                            <button type="button" class="btn btn-outline-light">Wed</button>

                            <button type="button" class="btn btn-outline-light">Thu</button>                                <p class="text-muted mb-1" style="font-size: 0.85rem; font-weight: 600;">Actions</p>

                            <button type="button" class="btn btn-outline-light">Fri</button>

                        </div>        <div class="col-md-6 col-lg-3">                                <h6 class="mb-0" style="font-weight: 700; color: #e74c3c;">Enter Grades</h6>

                    </div>

                </div>            <div class="card border-0 shadow-sm">                            </div>

                <div class="card-body p-0">

                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">                <div class="card-body">                            <div class="stat-icon bg-danger text-white">

                        <table class="table table-hover mb-0" style="font-size: 0.9rem;">

                            <thead class="table-light sticky-top">                    <div class="d-flex justify-content-between align-items-center">                                <i class="bi bi-pencil-fill" style="font-size: 1.5rem;"></i>

                                <tr>

                                    <th style="width: 15%; font-weight: 600;">Time</th>                        <div>                            </div>

                                    <th style="font-weight: 600;">Class</th>

                                    <th style="font-weight: 600;">Subject</th>                            <p class="text-muted small mb-1">Pending Tasks</p>                        </div>

                                </tr>

                            </thead>                            <h3 class="mb-0">{{ pending_tasks|default:0 }}</h3>                    </a>

                            <tbody>

                                {% for time_slot in time_slots %}                        </div>                </div>

                                <tr>

                                    <td class="fw-600" style="background-color: #f8f9fa;">{{ time_slot.label }}</td>                        <div style="font-size: 2rem; color: #dc3545;">            </div>

                                    <td colspan="2">

                                        {% if time_slot.classes %}                            <i class="bi bi-exclamation-circle"></i>        </div>

                                            {% for class in time_slot.classes %}

                                            <div class="d-flex justify-content-between align-items-center py-2">                        </div>    </div>

                                                <span><strong>{{ class.class_name }}</strong></span>

                                                <span class="badge bg-info">{{ class.subject }}</span>                    </div>

                                            </div>

                                            {% endfor %}                </div>    <!-- Charts Row -->

                                        {% else %}

                                            <span class="text-muted">No class scheduled</span>            </div>    <div class="row g-4 mb-4">

                                        {% endif %}

                                    </td>        </div>        {% if has_grades %}

                                </tr>

                                {% endfor %}    </div>        <div class="col-lg-6">

                            </tbody>

                        </table>            <div class="card h-100 border-0 shadow-sm">

                    </div>

                </div>    <!-- Quick Actions -->                <div class="card-header bg-primary text-white py-3">

            </div>

        </div>    <div class="row mb-4">                    <h6 class="mb-0" style="font-weight: 600;">

    </div>

</div>        <div class="col-12">                        <i class="bi bi-pie-chart-fill me-2"></i>Grade Distribution



<style>            <div class="card border-0 shadow-sm">                    </h6>

    .stat-icon {

        width: 45px;                <div class="card-body">                </div>

        height: 45px;

        border-radius: 8px;                    <h5 class="card-title mb-3">Quick Actions</h5>                <div class="card-body p-3">

        display: flex;

        align-items: center;                    <div class="d-flex flex-wrap gap-2">                    <div style="position: relative; height: 250px; max-width: 250px; margin: 0 auto;">

        justify-content: center;

        flex-shrink: 0;                        <a href="{% url 'teachers:enter_grades' %}" class="btn btn-primary btn-sm">                        <canvas id="gradeChart"></canvas>

    }

                            <i class="bi bi-pencil"></i> Enter Grades                    </div>

    .stat-card {

        transition: all 0.2s ease;                        </a>                </div>

    }

                        <a href="{% url 'teachers:mark_attendance' %}" class="btn btn-info btn-sm">            </div>

    .stat-card:hover {

        transform: translateY(-2px);                            <i class="bi bi-check-circle"></i> Mark Attendance        </div>

        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12) !important;

    }                        </a>        {% endif %}



    .btn-group-sm .btn {                        <a href="{% url 'teachers:teacher_list' %}" class="btn btn-secondary btn-sm">        

        padding: 0.4rem 0.8rem;

    }                            <i class="bi bi-list-ul"></i> View My Classes        {% if has_subjects %}



    @media (max-width: 768px) {                        </a>        <div class="col-lg-6">

        .container-fluid {

            padding-left: 0.75rem;                        <a href="{% url 'messages:inbox' %}" class="btn btn-warning btn-sm">            <div class="card h-100 border-0 shadow-sm">

            padding-right: 0.75rem;

        }                            <i class="bi bi-envelope"></i> Messages                <div class="card-header bg-success text-white py-3">

        

        .btn-group .btn {                        </a>                    <h6 class="mb-0" style="font-weight: 600;">

            font-size: 0.75rem !important;

        }                    </div>                        <i class="bi bi-bar-chart-fill me-2"></i>Subject Performance

    }

</style>                </div>                    </h6>



<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>            </div>                </div>

{% endblock %}

        </div>                <div class="card-body p-3">

{% block extra_js %}

<script>    </div>                    <div style="position: relative; height: 250px;">

    document.addEventListener('DOMContentLoaded', function() {

        // Grade Distribution Chart                        <canvas id="subjectChart"></canvas>

        const gradeCtx = document.getElementById('gradeChart');

        if (gradeCtx) {    <!-- Main Content Sections -->                    </div>

            const gradeLabels = {{ grade_labels|safe }};

            const gradeCounts = {{ grade_counts|safe }};    <div class="row">                </div>

            

            if (gradeLabels && gradeLabels.length > 0) {        <div class="col-lg-8 mb-4">            </div>

                const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384'];

                const backgroundColors = colors.slice(0, gradeLabels.length);            <div class="card border-0 shadow-sm">        </div>

                

                new Chart(gradeCtx.getContext('2d'), {                <div class="card-body">        {% endif %}

                    type: 'doughnut',

                    data: {                    <h5 class="card-title mb-3">Recent Activities</h5>    </div>

                        labels: gradeLabels,

                        datasets: [{                    <div class="text-center text-muted py-4">

                            data: gradeCounts,

                            backgroundColor: backgroundColors,                        <i class="bi bi-inbox" style="font-size: 2rem; opacity: 0.5;"></i>    <!-- Schedule Section -->

                            borderColor: '#fff',

                            borderWidth: 2                        <p class="mt-2 mb-0">No recent activities</p>    <div class="row">

                        }]

                    },                    </div>        <div class="col-12">

                    options: {

                        responsive: true,                </div>            <div class="card border-0 shadow-sm">

                        maintainAspectRatio: true,

                        plugins: {            </div>                <div class="card-header bg-info text-white py-3">

                            legend: {

                                position: 'bottom',        </div>                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">

                                labels: {

                                    padding: 15,                        <h6 class="mb-0" style="font-weight: 600;">

                                    font: { size: 12 }

                                }        <div class="col-lg-4 mb-4">                            <i class="bi bi-calendar-week me-2"></i>{{ selected_day_label|default:"Today's" }} Schedule

                            }

                        }            <div class="card border-0 shadow-sm">                        </h6>

                    }

                });                <div class="card-body">                        <div class="btn-group btn-group-sm" role="group">

            }

        }                    <h5 class="card-title mb-3">Attendance Summary</h5>                            {% for day_code, day_label in days %}

        

        // Subject Performance Chart                    <div class="list-group list-group-flush">                                <a href="?day={{ day_code }}"

        const subjectCtx = document.getElementById('subjectChart');

        if (subjectCtx) {                        <div class="list-group-item px-0 py-2">                                   class="btn {% if day_code == selected_day %}btn-light text-info{% else %}btn-outline-light{% endif %}"

            const subjectNames = {{ subject_names|safe }};

            const avgMarks = {{ avg_marks|safe }};                            <span class="text-muted">Today's Attendance</span>                                   style="font-size: 0.85rem;">

            

            if (subjectNames && subjectNames.length > 0) {                            <span class="badge bg-success float-end">Pending</span>                                    {{ day_label|slice:":3" }}

                new Chart(subjectCtx.getContext('2d'), {

                    type: 'bar',                        </div>                                </a>

                    data: {

                        labels: subjectNames,                        <div class="list-group-item px-0 py-2">                            {% endfor %}

                        datasets: [{

                            label: 'Avg Marks',                            <span class="text-muted">This Week</span>                        </div>

                            data: avgMarks,

                            backgroundColor: '#36A2EB',                            <span class="badge bg-info float-end">View</span>                    </div>

                            borderColor: '#1e7e8b',

                            borderWidth: 1,                        </div>                </div>

                            borderRadius: 4

                        }]                        <div class="list-group-item px-0 py-2">                <div class="card-body p-0">

                    },

                    options: {                            <span class="text-muted">This Month</span>                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">

                        indexAxis: 'y',

                        responsive: true,                            <span class="badge bg-secondary float-end">Report</span>                        <table class="table table-hover mb-0" style="font-size: 0.9rem;">

                        maintainAspectRatio: true,

                        plugins: {                        </div>                            <thead class="table-light sticky-top">

                            legend: {

                                display: false                    </div>                                <tr>

                            }

                        },                </div>                                    <th style="width: 15%; font-weight: 600;">Time</th>

                        scales: {

                            x: {            </div>                                    <th style="font-weight: 600;">Class</th>

                                beginAtZero: true,

                                max: 100        </div>                                    <th style="font-weight: 600;">Subject</th>

                            }

                        }    </div>                                </tr>

                    }

                });</div>                            </thead>

            }

        }                            <tbody>

    });

</script><style>                                {% for time_slot in time_slots %}

{% endblock %}

    .card {                                    {% with day_classes=time_slot.classes|get_item:selected_day %}

        transition: transform 0.2s, box-shadow 0.2s;                                    <tr>

    }                                        <td class="fw-600" style="background-color: #f8f9fa;">{{ time_slot.label }}</td>

    .card:hover {                                        <td colspan="2" {% if day_classes %}class="table-light"{% endif %}>

        transform: translateY(-2px);                                            {% if day_classes %}

        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;                                                {% for class in day_classes %}

    }                                                    <div class="d-flex justify-content-between align-items-center py-2">

</style>                                                        <span><strong>{{ class.class_name }}</strong></span>

{% endblock %}                                                        <span class="badge bg-info">{{ class.subject }}</span>

                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <span class="text-muted">No class scheduled</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endwith %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stat-icon {
        width: 45px;
        height: 45px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .stat-card {
        transition: all 0.2s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12) !important;
    }

    .btn-group-sm .btn {
        padding: 0.4rem 0.8rem;
    }

    @media (max-width: 768px) {
        .container-fluid {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        .btn-group .btn {
            font-size: 0.75rem !important;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Grade Distribution Chart
        const gradeCtx = document.getElementById('gradeChart');
        if (gradeCtx) {
            const gradeLabels = {{ grade_labels|safe }};
            const gradeCounts = {{ grade_counts|safe }};
            
            if (gradeLabels && gradeLabels.length > 0) {
                const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384'];
                const backgroundColors = colors.slice(0, gradeLabels.length);
                
                new Chart(gradeCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: gradeLabels,
                        datasets: [{
                            data: gradeCounts,
                            backgroundColor: backgroundColors,
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: { size: 12 }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Subject Performance Chart
        const subjectCtx = document.getElementById('subjectChart');
        if (subjectCtx) {
            const subjectNames = {{ subject_names|safe }};
            const avgMarks = {{ avg_marks|safe }};
            
            if (subjectNames && subjectNames.length > 0) {
                new Chart(subjectCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: subjectNames,
                        datasets: [{
                            label: 'Avg Marks',
                            data: avgMarks,
                            backgroundColor: '#36A2EB',
                            borderColor: '#1e7e8b',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }
    });
</script>
{% endblock %}
